"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[40],{876:(e,n,t)=>{t.d(n,{Zo:()=>l,kt:()=>h});var a=t(2784);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),d=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},l=function(e){var n=d(e.components);return a.createElement(s.Provider,{value:n},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},v=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),u=d(t),v=r,h=u["".concat(s,".").concat(v)]||u[v]||p[v]||i;return t?a.createElement(h,o(o({ref:n},l),{},{components:t})):a.createElement(h,o({ref:n},l))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=v;var c={};for(var s in n)hasOwnProperty.call(n,s)&&(c[s]=n[s]);c.originalType=e,c[u]="string"==typeof e?e:r,o[1]=c;for(var d=2;d<i;d++)o[d]=t[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}v.displayName="MDXCreateElement"},389:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>c,toc:()=>d});var a=t(7896),r=(t(2784),t(876));const i={id:"advanced-activation-handlers",title:"Activation handlers"},o=void 0,c={unversionedId:"advanced-activation-handlers",id:"advanced-activation-handlers",title:"Activation handlers",description:"Activation handlers are useful tool for providing external behaviors to scene objects. When a scene object is mounted, activation handlers are called.",source:"@site/../docs/advanced-activation-handlers.md",sourceDirName:".",slug:"/advanced-activation-handlers",permalink:"/scenes/docs/advanced-activation-handlers",draft:!1,editUrl:"https://github.com/grafana/scenes/edit/main/docusaurus/website/../docs/advanced-activation-handlers.md",tags:[],version:"current",frontMatter:{id:"advanced-activation-handlers",title:"Activation handlers"},sidebar:"sidebar",previous:{title:"Custom scene objects",permalink:"/scenes/docs/advanced-custom-scene-objects"},next:{title:"Data and time range in custom scene objects",permalink:"/scenes/docs/advanced-data"}},s={},d=[{value:"Add activation handlers",id:"add-activation-handlers",level:2},{value:"Step 1. Create a scene",id:"step-1-create-a-scene",level:3},{value:"Step 2. Add an activation handler",id:"step-2-add-an-activation-handler",level:3},{value:"Step 3. Return a deactivation handler",id:"step-3-return-a-deactivation-handler",level:3},{value:"Source code",id:"source-code",level:2}],l={toc:d},u="wrapper";function p(e){let{components:n,...t}=e;return(0,r.kt)(u,(0,a.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Activation handlers are useful tool for providing external behaviors to scene objects. When a scene object is mounted, activation handlers are called."),(0,r.kt)("p",null,"Similarly to React's ",(0,r.kt)("inlineCode",{parentName:"p"},"useEffect"),", activation handlers return a ",(0,r.kt)("inlineCode",{parentName:"p"},"function(deactivation handler)")," that should be used to clean up all behaviors added in an activation handler. A deactivation handler is called when a scene object is unmounted."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Activation handlers are especially useful if you want to add external behaviors to core scene objects. They reduce the need for implementing custom scene objects that would handle scene object connections.")),(0,r.kt)("p",null,"This topic describes how to create and use activation handlers."),(0,r.kt)("h2",{id:"add-activation-handlers"},"Add activation handlers"),(0,r.kt)("p",null,"Follow these steps to create an activation handler."),(0,r.kt)("h3",{id:"step-1-create-a-scene"},"Step 1. Create a scene"),(0,r.kt)("p",null,"Start by creating a scene that renders a time series panel and a text panel:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const queryRunner = new SceneQueryRunner({\n  datasource: {\n    type: 'prometheus',\n    uid: '<PROVIDE_GRAFANA_DS_UID>',\n  },\n  queries: [\n    {\n      refId: 'A',\n      range: true,\n      format: 'time_series',\n      expr: 'rate(prometheus_http_requests_total[5m])',\n    },\n  ],\n});\n\nconst timeSeriesPanel = PanelBuilders.timeseries().setTitle('Panel title').setData(queryRunner).build();\nconst debugView = PanelBuilders.text()\n  .setTitle('Debug view')\n  .setOption('mode', TextMode.HTML)\n  .setOption('content', '')\n  .build();\n\nconst scene = new EmbeddedScene({\n  $timeRange: new SceneTimeRange(),\n  controls: [new SceneTimePicker({ isOnCanvas: true }), new SceneRefreshPicker({ isOnCanvas: true })],\n  body: new SceneFlexLayout({\n    direction: 'column',\n    children: [\n      new SceneFlexItem({\n        body: timeSeriesPanel,\n      }),\n      new SceneFlexItem({\n        width: '30%',\n        body: debugView,\n      }),\n    ],\n  }),\n});\n")),(0,r.kt)("h3",{id:"step-2-add-an-activation-handler"},"Step 2. Add an activation handler"),(0,r.kt)("p",null,"Add an activation handler to ",(0,r.kt)("inlineCode",{parentName:"p"},"SceneQueryRunner")," that subscribes to state changes and shows the executed query in the text panel. Keep in mind that a subscription to state won't be created until ",(0,r.kt)("inlineCode",{parentName:"p"},"SceneQueryRunner")," is activated:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"queryRunner.addActivationHandler(() => {\n  let log = '';\n\n  const sub = queryRunner.subscribeToState((state) => {\n    log =\n      `${new Date(Date.now()).toLocaleTimeString()} Executed query: <pre>${state.queries.map((q) => q.expr)}</pre>\\n` +\n      log;\n    debugView.setState({\n      options: {\n        content: log,\n      },\n    });\n  });\n});\n")),(0,r.kt)("h3",{id:"step-3-return-a-deactivation-handler"},"Step 3. Return a deactivation handler"),(0,r.kt)("p",null,"From the activation handler, return a function that will unsubscribe from ",(0,r.kt)("inlineCode",{parentName:"p"},"queryRunner")," state changes when the object is deactivated:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"queryRunner.addActivationHandler(() => {\n  let log = '';\n\n  const sub = queryRunner.subscribeToState((state) => {\n    log =\n      `${new Date(Date.now()).toLocaleTimeString()} Executed query: <pre>${state.queries.map((q) => q.expr)}</pre>\\n` +\n      log;\n    debugView.setState({\n      options: {\n        content: log,\n      },\n    });\n  });\n\n  // Return deactivation handler\n  return () => {\n    sub.unsubscribe();\n  };\n});\n")),(0,r.kt)("h2",{id:"source-code"},"Source code"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/grafana/scenes/tree/main/docusaurus/docs/advanced-activation-handlers.tsx"},"View the example source code")))}p.isMDXComponent=!0}}]);